# IP

IP는 osi 7계층 중에서 제 3계층인 네트워크층에 해당된다. 네트워크 층의 특징은 다음과 같다. 

<center>

**종점 노드간의 통신을 실현한다.**

</center>

위와 같이 종점 노드간의 통신을 실현하기 위해서는 데이터 링크의 차이를 은폐해야 한다. 즉 다른 데이터 링크를 가진 애들과 통싱할 수 있게 한다. 

데이터 링크층과 네트워크 층의 차이는 다음과 같다. 
* 데이터 링크층: 직접 연결된 기기간의 통신을 제공
* 네트워크 층: 직접 연결되어있지 않은 네트워크 간의 전송

데이터 링크층으로 통신하지 않고 네트워크 층으로 통신하면 어떤점이 좋을까? 

<center>

```
            host A        Router A       Router B       Router C          host B
            |---------------|---------------|---------------|---------------|
                ethernet          ip-vpn          기가바이트          ATM   
                                                인터넷

                                    [데이터 링크층으로 통신하는 구조]

            host A                                                        host B
            |---------------------------------------------------------------|

                                    [네트워크 층으로 통신하는 구조] 
```
</center>

위와 같은 구조로 되어있을때 데이터 링크층으로 통신하는 구조에서는 총 4홉을 통해서 통신을 한다. 하지만 네트워크 층을 사용한다면 end-to-end 통신을 재현할 수 있다.

IP 역할
 * IP 주소
 * 종점 호스트까지의 패킷 배송 (라우팅)
 * IP 패킷의 분할처리와 재구축 처리

## IP 주소

 - IP 주소
   - 네트워크층의 식별 주소
   - 네트워크에 연결되어있는 모든 호스트 중에서 통신 상대를 식별할 때 사용.

 - MAC 주소 $\rightarrow$ 데이터 링크층의 식별자.

 - 참고 : 브리지나 스위칭 허브와 같이 물리츨이나 데이터 링크 층에서 패킷을 중계하는 기기에는 IP주소를 설정할 필요가 없다. $\rightarrow$ MAC 주소를 전달 받아서 비교후, 해당되는 MAC 주소에 전달. 


## 라우팅

 - 수신처 IP 주소를 가진 호스트까지 패킷을 전달하기 위한 기능. 

![라우팅 예시](image/routing.png)

위 그림을 통해서 라우팅은 a.a.a.a IP를 가지는 A 호스트가 b.b.b.b IP를 가지는 B 호스트로 갈수 있게 해준다. 위와 같이 경로를 알 경우 **홉 바이 홉 라우팅** 아리고 한다. 

그러면 만약에 목적지는 아는데 경로를 모르면 어떻게 되는가? 
1. IP 패킷이 라우터에 도착하면, 수신처 IP 주소를 조사한다. 
2. 해당 패킷을 그 다음에 전달할 라우터를 결정하고, 그 라우터로 보낸다.
3. IP 패킷이 그 라우터에 도착하면, 다시 수신처 IP 패킷을 조사하여 그 다음 라우터로 전송한다. 

### 실제 라우팅 테이블 예시

```
 Destination          Gateway             Genmask            Flags   MSS  Window  irtt  Iface

 211.214.178.201      0.0.0.0           255.255.255.224         U    40  0         0  eth0

 127.0.0.1             0.0.0.0              255.0.0.0           U    40  0         0  lo

 0.0.0.0            211.214.178.254         0.0.0.0            UG    40  0         0  eth0
```

## IP 패킷의 분할처리와 재구축 처리

 - IP는 다른 호스트와 통신을 하기 위해서 데이터 링크를 추상화 해야 한다. $\rightarrow$ 근데 MTU는 연결방식에 따라 다른 값을 가진다. 
 - 이를 처리하기 위해 분할처리(프래그맨테이션)을 한다.

![분할 처리 예시](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FdJ5yFQ%2FbtraNIcnHRM%2FlPLvr15RcanWrhIPw1KcAK%2Fimg.png)

